---
// Countdown Timer component
---

<section class="sticky top-0 z-50 bg-gradient-to-r from-red-600 to-red-800 py-4 px-6 text-center shadow-lg">
  <div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-center mb-2">
      <img src="/hourglass-not-done.png" alt="Hourglass" class="w-6 h-6 mr-2">
      <h2 class="text-lg md:text-xl font-bold text-white">
        &iexcl;Oferta disponible solo por los pr&oacute;ximos 15 minutos!
      </h2>
    </div>
    
    <div class="text-center">
      <div class="text-2xl md:text-4xl font-mono font-bold text-white mb-2" id="countdown">
        15:00
      </div>
      <p class="text-sm md:text-base text-red-100">
        Despu&eacute;s de este tiempo, el precio vuelve a $87
      </p>
    </div>
  </div>
</section>

<script>
  const countdownEl = document.getElementById('countdown') as HTMLElement | null;

  function startCountdown(durationInMinutes: number = 15): void {
    const existing = sessionStorage.getItem('rutaCountdown');
    let deadline: Date;

    if (existing) {
      deadline = new Date(parseInt(existing));
    } else {
      deadline = new Date();
      deadline.setMinutes(deadline.getMinutes() + durationInMinutes);
      sessionStorage.setItem('rutaCountdown', deadline.getTime().toString());
    }

    function updateCountdown(): void {
      if (!countdownEl) return;
      
      const now = new Date();
      const diff = deadline.getTime() - now.getTime();

      if (diff <= 0) {
        countdownEl.textContent = '00:00';
        countdownEl.classList.add('text-red-300');
        return;
      }

      const minutes = Math.floor(diff / 60000);
      const seconds = Math.floor((diff % 60000) / 1000);
      countdownEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Cambiar color cuando quedan menos de 5 minutos
      if (minutes < 5) {
        countdownEl.classList.add('animate-pulse');
      }
      
      requestAnimationFrame(updateCountdown);
    }

    updateCountdown();
  }

  startCountdown();
</script> 